stages:
  - build
  - push

variables:
  # Имя образа (можно изменить под ваш проект)
  IMAGE_NAME: "bot-service"
  # Тег образа (можно использовать CI переменные для версионирования)
  IMAGE_TAG: "latest"
  # Полный путь до образа в GitLab Container Registry
  # Формат: registry.gitlab.com/<namespace>/<project>/<image>
  IMAGE_FULL_PATH: "$CI_REGISTRY_IMAGE/$IMAGE_NAME:$IMAGE_TAG"
  DOCKER_HOST: tcp://docker:2375
  DOCKER_TLS_CERTDIR: ""

build-image:
  stage: build
  image: docker:24.0
  tags:
    - build
  services:
    - docker:24.0-dind
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker build -f Dockerfile-bot-service -t $IMAGE_FULL_PATH .
    - docker push $IMAGE_FULL_PATH
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH  # Запускать только для main ветки (можно изменить)